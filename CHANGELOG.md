# 更新日志 (Changelog)

本文档记录学生请假管理系统的所有重要变更。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
版本号遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

## [Unreleased]

## [1.1.0] - 2026-01-04

### 新增
- **通知系统**：管理员可以向班主任发送通知
- **批量通知**：支持向多个班主任批量发送通知
- **通知聚合显示**：批量发送的通知在已发送页面聚合展示
- **自动已读**：通知列表展开后自动标记为已读
- **通知清理**：支持清理已读通知功能
- **通知统计**：首页显示通知统计（总数、未读数）
- **多数据库管理**：支持管理多个 PostgreSQL 数据库连接
- **数据库切换**：支持在多个数据库之间切换
- **数据库连接测试**：创建连接前测试连接有效性
- **切换历史**：记录数据库切换历史
- **自动表结构创建**：切换数据库时自动创建缺失的表

### 变更
- **数据库迁移**：从 SQLite 迁移到 PostgreSQL
- **技术栈更新**：使用 Drizzle ORM + PostgreSQL
- **Next.js 15**：完全兼容 Next.js 15（async route params）

### 修复
- 修复导航双击问题（Next.js 15 + React 19）
- 修复班级编辑时班主任"无"选项无法选择
- 修复新增年级时默认学期显示问题
- 修复数据备份时区显示问题
- 修复备份恢复的 UNSAFE_TRANSACTION 错误

### 安全
- 数据库连接字符串加密存储
- SQL 注入防护增强（PostgreSQL 参数化查询）

## [1.0.0] - 2025-12-31

### 新增
- **学生请假管理系统**首次发布
- 用户管理（管理员、教师、班主任）
- 学生档案管理（营养餐标记）
- 班级管理、年级管理、学期管理
- 请假管理（含退费计算）
- 费用配置
- 数据备份与恢复
- 操作日志、统计报表
- Excel 导入导出
- 学期数据隔离
- 单元测试（86 个测试用例）

### 部署支持
- Docker 容器化部署
- PM2 进程管理
- Systemd 系统服务
- Nginx 反向代理配置

---

## 版本说明

- **新增**：新功能
- **变更**：现有功能的变更
- **弃用**：即将删除的功能
- **移除**：已删除的功能
- **修复**：bug 修复
- **安全**：安全相关的修复或改进
